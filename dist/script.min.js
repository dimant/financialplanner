(()=>{function e(e,t){let n=null;const o=function(e){return function(){let t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}}(4294967295&Date.now());return function(){if(null!==n){const o=n;return n=null,e+t*o}let r,a,l;do{r=2*o()-1,a=2*o()-1,l=r*r+a*a}while(0===l||l>=1);const u=Math.sqrt(-2*Math.log(l)/l);return n=a*u,e+t*r*u}}document.addEventListener("DOMContentLoaded",function(){function e(e,t,n){var o=document.getElementById(e);o&&o.addEventListener("click",function(e){e.preventDefault(),fetch(t).then(function(e){return e.text()}).then(function(e){document.getElementById("tool-content").innerHTML=e,setTimeout(function(){document.getElementById("tool-content").querySelectorAll("script").forEach(function(e){var t=document.createElement("script");e.src?t.src=e.src:t.textContent=e.textContent,e.parentNode.replaceChild(t,e)}),"function"==typeof window[n]&&window[n]()},0)})})}e("retirement-link","retirement.html","initRetirementPlanner"),e("homepurchase-link","homepurchase.html","initHomePurchasePlanner");var t=document.getElementById("home-link");t&&t.addEventListener("click",function(e){e.preventDefault(),fetch("home.html").then(function(e){return e.text()}).then(function(e){document.getElementById("tool-content").innerHTML=e})})});let t=null;function n(e,t){const n=[];let o=0;for(let r=0;r<t;r++){const t=e();n.push(t),t.length>o&&(o=t.length)}for(let e of n)for(;e.length<o;)e.push(e[e.length-1]);const r=[],a=[],l=[];for(let e=0;e<o;e++){const t=n.map(t=>t[e]).sort((e,t)=>e-t),o=t.length;r.push(t.reduce((e,t)=>e+t,0)/o);const u=Math.floor(.05*(o-1));a.push(t[u]);const m=Math.ceil(.95*(o-1));l.push(t[m])}return{avg:r,p5:a,p95:l}}function o(e,n){const{avg:o,p5:r,p95:a}=n(),l=document.getElementById("growthChart").getContext("2d");t&&t.destroy();const u=Array.from({length:o.length},(t,n)=>e+n);t=new Chart(l,{type:"line",data:{labels:u,datasets:[{label:"Average Portfolio Value (USD)",data:o,borderColor:"#059669",backgroundColor:"rgba(16, 185, 129, 0.1)",fill:!1,tension:.3,pointRadius:2,pointBackgroundColor:"#059669",order:1},{label:"95th Percentile",data:a,borderColor:"rgba(59,130,246,0.5)",backgroundColor:"rgba(59,130,246,0.1)",fill:"-1",pointRadius:0,borderWidth:0,order:0},{label:"5th Percentile",data:r,borderColor:"rgba(239,68,68,0.5)",backgroundColor:"rgba(239,68,68,0.1)",fill:"-1",pointRadius:0,borderWidth:0,order:0}]},options:{responsive:!0,plugins:{legend:{display:!0,labels:{color:"#166534",font:{family:"Montserrat",weight:"bold"}}}},scales:{x:{title:{display:!0,text:"Year",color:"#166534",font:{family:"Montserrat",weight:"bold"}},ticks:{color:"#166534"}},y:{title:{display:!0,text:"USD",color:"#166534",font:{family:"Montserrat",weight:"bold"}},ticks:{color:"#166534",callback:function(e){return"$"+e.toLocaleString()}},beginAtZero:!0}}}})}window.initRetirementPlanner=function(){const t=document.getElementById("yearsUntilRetirement"),r=document.getElementById("planningHorizonForm");if(!t||!r)return;const a=(new Date).getFullYear(),l=()=>{const t={CurrentSavings:Number(document.getElementById("currentSavings").value),AnnualSavings:Number(document.getElementById("annualSavings").value),YearsUntilRetirement:Number(document.getElementById("yearsUntilRetirement").value),RetirementYears:Number(document.getElementById("retirementYears").value),AnnualExpenses:Number(document.getElementById("annualExpenses").value),InflationRate:Number(document.getElementById("inflationRate").value)/100,RetirementTaxRate:Number(document.getElementById("retirementTaxRate").value)/100,MeanReturn:Number(document.getElementById("meanReturn").value)/100,StandardDeviationReturn:Number(document.getElementById("standardDeviationReturn").value),NumSimulations:Number(document.getElementById("numSimulations").value)};return n(()=>function(e,t){const n=[];let o=e.CurrentSavings;for(let r=0;r<e.YearsUntilRetirement;r++)o*=1+t(),o+=e.AnnualSavings,n.push(o);let r=e.AnnualExpenses;for(let a=0;a<e.RetirementYears;a++)o*=1+t(),o-=r/(1-e.RetirementTaxRate),n.push(o),r*=1+e.InflationRate;return n}(t,e(t.MeanReturn,t.StandardDeviationReturn)),t.NumSimulations)};let u=a+Number(t.value);o(a,l);const m=r.cloneNode(!0);r.parentNode.replaceChild(m,r),m.addEventListener("submit",function(e){e.preventDefault(),u=a+Number(t.value),o(a,l)})},window.initHomePurchasePlanner=function(){const t=(new Date).getFullYear();function r(){const e=document.getElementById("loanAmount"),t=document.getElementById("mortgageRate"),n=document.getElementById("mortgageYears"),o=document.getElementById("monthlyPayment");function r(){const r=function(e,t,n){const o=t/12,r=12*n;if(0===o)return e/r;const a=e*o/(1-Math.pow(1+o,-r));let l=e,u=0;for(let e=0;e<12&&l>0;e++){const e=l*o,t=Math.min(a-e,l);u+=e+t,l-=t}return u/12}(Number(e.value),Number(t.value)/100,Number(n.value));o.value=isFinite(r)?r.toFixed(2):""}e&&t&&n&&o&&(o.disabled=!0,e.addEventListener("input",r),t.addEventListener("input",r),n.addEventListener("input",r),r())}r();const a=()=>{const t={downPayment:Number(document.getElementById("downPayment").value),loanAmount:Number(document.getElementById("loanAmount").value),mortgageRate:Number(document.getElementById("mortgageRate").value)/100,mortgageYears:Number(document.getElementById("mortgageYears").value),monthlyPayment:Number(document.getElementById("monthlyPayment").value),homeAppreciationMean:Number(document.getElementById("homeAppreciationMean").value)/100,homeAppreciationStd:Number(document.getElementById("homeAppreciationStd").value),propertyTaxes:Number(document.getElementById("propertyTaxes").value),homeInsurance:Number(document.getElementById("homeInsurance").value),maintenanceRate:Number(document.getElementById("maintenanceRate").value)/100,hoaFees:Number(document.getElementById("hoaFees").value),buyingCosts:Number(document.getElementById("buyingCosts").value)/100,sellingCosts:Number(document.getElementById("sellingCosts").value)/100,taxRate:Number(document.getElementById("taxRate").value)/100,NumSimulations:Number(document.getElementById("numSimulations").value)};return n(()=>function(e,t){const n=e.mortgageYears;let o=e.downPayment+e.loanAmount,r=e.loanAmount;const a=e.mortgageRate,l=a/12,u=12*n;let m=e.monthlyPayment;m&&0!==m||(m=r*l/(1-Math.pow(1+l,-u)));const i=[];for(let a=0;a<n;a++){o*=1+t();for(let e=0;e<12;e++)if(r>0){const e=r*l;r-=Math.min(m-e,r)}const n=e.sellingCosts||0,a=o-Math.max(r,0)-n*o;i.push(a)}return i}(t,e(t.homeAppreciationMean,t.homeAppreciationStd)),t.NumSimulations)};o(t,a);const l=document.getElementById("homePurchaseForm");if(!l)return;const u=l.cloneNode(!0);l.parentNode.replaceChild(u,l),u.addEventListener("submit",function(e){e.preventDefault(),o(t,a)}),setTimeout(r,0)}})();